---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(palmerpenguins)
library(tidyverse)
library(knitr)
```

# Presenting and Visualizing Data

### Intro to data visualization with ggplot2

`ggplot2` is an R package for data visualization that will allow you to make pretty graphs with a simplified and standardized syntax!

First, let's load the package:

```{r}
library(ggplot2)
```

##### What kind of data do we need?

In order to get started with graphing in `ggplot2`, we'll need our data to be in what's called "tidy" format. [Here](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html) is some information about what it means for a dataset to be tidy. 

Briefly, for a dataset to be tidy, it must follow these three rules:

1. Each variable must have its own column

2. Each observation must have its own row

3. Each value must have its own cell

Let's look at an example of an untidy versus a tidy dataset that you might come across:

```{r, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}
#making a simple untidy dataset using palmerpenguins
penguin <- penguins %>%
  drop_na(body_mass_g) %>%
  group_by(island, year) %>%
  summarize(mean_body_mass_g = mean(body_mass_g)) %>%
  spread(year, mean_body_mass_g)

#tidy version
penguin_tidy <- penguin %>%
  gather(key = "year", value = "mean_body_mass_g", `2007`, `2008`, `2009`)
```

```{r, echo = FALSE}
kable(penguin)
```

The values in the cells of this dataset are the average body mass of penguins. Now we can ask ourselves if this dataset matches with tidy formatting. Does each variable have its own column? Our variables in this dataset are year, island, and body mass. But our columns are island, 2007, 2008, and 2009. Let's fix that.

```{r, echo = FALSE}
kable(penguin_tidy)
```

Now, we have three variables, each of which has its own column. Is each row one observation? Yes: each row is an observation of the average weight of the penguins on one island in one year. Does each value have its own cell? Yes: each cell contains either an island name, a year, or an average body mass.

Now that it's tidy, let's graph this data!

##### Graphing

How did average body mass change over time on each of these islands?

```{r}
ggplot(data = penguin_tidy, mapping = aes(x = year, y = mean_body_mass_g, color = island)) +
  geom_point()
```

Let's look at the components of our ggplot2 code, and how they made this graph:

First, we specified the `data` we were using, the tidied penguin data. Next comes `mapping`, which essentially means "which variables go where": we told this graph to put year as the x axis, mean body mass as the y axis, and islands as the different colors. Finally, we tell `ggplot2` what `geom` we are using. Here I decided to use points. 

Note that our use of color here will allow us to represent the variable `island`, but if we just wanted to make all of our points blue (or some other color), we could use:

```{r}
ggplot(data = penguin_tidy, mapping = aes(x = year, y = mean_body_mass_g)) +
  geom_point(color = "blue")
```

Note that we dropped the `color = island` statement in `aes()` and added `color = "blue"` to `geom_point()`.

##### Other Types of Graphs!

Luckily, the `penguins` dataset that comes with `palmerpenguins` is already beautifully tidy. Here are some more examples of graphs that you can make with `ggplot2`.

You can create a line-graph in exactly the same was as a scatterplot by swapping the `geom_point()` call for `geom_line`!

```{r}
ggplot(data = penguins, mapping = aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_line()
```

Bar plots use the call `geom_bar()`. You can display another variable by including `fill = ` inside of your aes() call!

```{r}
ggplot(data = penguins, mapping = aes(x = island, fill = sex)) +
  geom_bar()
```

When making histograms with `ggplot2`, you can decide the width or the number of the bins of the histogram as appropriate for your data. Here I chose to use a binwidth of 100 grams:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = body_mass_g)) +
  geom_histogram(binwidth = 100)
```

Another useful graph to have in your back-pocket is the boxplot. You can create multiple boxplots on the same graph by setting your 'x' to a variable with multiple levels. In this example our call will create a boxplot for each individual island!

```{r}
ggplot(data = penguins, mapping  = aes(x = island, y = body_mass_g)) +
  geom_boxplot()
```

##### More Aesthetics and Geoms!

Below are some more examples of different aesthetics available with `ggplot2`.

Sometimes, when using geom_point, our points can get a bit crowded. One way to address this is to change the transparency of the points. In this code, `alpha = 0.7` specifies the transparency of the points as 0.7, on a scale from 0 (most transparent) to 1 (least transparent):

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.7)
```

What if we want to add another variable, but our graph is already a bit "busy" to look at? This is where facet_wrap can come in handy. Here, I faceted by species, creating three graphs, with the same x and y axes and coloring. These graphs let us compare species side-by-side easily:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~species)
```

### Making summary tables in R

_yada yada about `kable`_

### Writing up your results

_yada yada about R Markdown_
