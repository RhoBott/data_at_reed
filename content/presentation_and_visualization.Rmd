---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(palmerpenguins)
library(tidyverse)
library(knitr)
```

# Presenting and Visualizing Data

### Intro to data visualization with `ggplot2`

`ggplot2` is an R package for data visualization that will allow you to make appealing and effective graphs using a simplified and standardized syntax.

First, let's load the package. This is necessary every time you start an R session.  We will also load `palmerpenguins`, a package that contains a dataset about penguin populations on islands in Antarctica. To learn more about packages and the `palmerpenguins` package, see our [Getting Started](LINK-HERE) page.

```{r}
library(ggplot2)
library(palmerpenguins)
```

Before we get started with graphing in `ggplot2`, we will need our data to be in  "tidy" format. You can read more about what it means for a dataset to be tidy on [our data wrangling page](LINK-HERE) or [from the tidyverse team](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html).


There are three main pieces that make up a ggplot:

1. Data: You have to specify the data that you want `ggplot()` to plot using the following syntax: 
      
              data = ___

2. Aesthetics: In order for `ggplot()` to know which variables you want to use you have to specify what they are by using some combination of aesthetics, such as:

              aes(x = ___ , y = ___ , color = ___ , fill = ___ )

Anything that you put inside of `aes()` should be a variable. Additionally, though some possible aesthetics are given here (`x`, `y`, `color`, and `fill`), the ones that you end up using will be specific to your graph type. For example, in a typical histogram you are looking at the distribution of one variable so you only have to include `x = ___ `, and not the other inputs.

3. Geoms: We can specify what kind of plot we want to make using the following syntax: 

              geom_ ___()

`ggplot2` comes with all sorts of `geom`s built in, but a couple of common ones are `geom_point()` for a scatterplot, `geom_histogram()` for a histogram, or `geom_boxplot()` for a boxplot. The word `geom` refers to the visual object used to represent data. 

We can put all of this together to create a full template for making graphs with `ggplot()`:

              ggplot(data = ___ ,
                     mapping = aes(x = ___  , y = ___  , color = ___  , fill = ___   ) +
                geom_ ___()
          
Note that, in `ggplot2`, layers are added with `+` rather than the pipe `%>%`. When debugging `ggplot2` code, it is usually a good place to start to make sure you have added the new layer rather than piped.

You can always refer back to this template as a way to remember the `ggplot2` syntax. The next several sections will show a few different example graphs.


#### Scatterplots

Suppose we are interested in how body mass changed over time on each of these islands. The following `ggplot2` graph might help us get at this question:

```{r}
ggplot(data = penguins, 
       mapping = aes(x = bill_length_mm, y = body_mass_g, color = island)) +
  geom_point()
```

Let's look at the components of our code, and how they made this graph:

First, we specified the `data` we were using, the penguin data. Next comes `mapping`, which essentially means "which variables encode what information": we told this graph to put bill length as the x axis, body mass as the y axis, and islands as the different colors. Finally, we add a `geom` layer to our plot, where we decided to use points. 

#### Linegraphs

You can create a smoothed linegraph in exactly the same way as a scatterplot by swapping out `geom_point()` for `geom_line()`. This is an example of a different `geom` being used to represent the same data. 

```{r, message = FALSE, warning = FALSE}
ggplot(data = penguins, 
       mapping = aes(x = bill_length_mm, y = body_mass_g, color = island)) +
  geom_smooth()
```

#### Barplots

Bar plots use the call `geom_bar()`. 

```{r}
ggplot(data = penguins, mapping = aes(x = island)) +
  geom_bar()
```

You can display another variable by including `fill = ` inside of your `aes()` call.

```{r}
ggplot(data = penguins, mapping = aes(x = island, fill = sex)) +
  geom_bar()
```

In the above examples, `ggplot2` determines the height of bars by counting the number of observations behind the scenes. This is why we do not provide `geom_bar()` with a `y` aesthetic. Sometimes, though, you might need to work with data that is "pre-counted." For example, if we make a new dataset with the count of penguins by `island`:

```{r, message = FALSE, warning = FALSE}
penguins_sum <- penguins %>%
  count(island)

penguins_sum
```

To make the same graph, we need to use the `geom_col()` (as in "column") function, rather than `geom_bar()`, and supply the height of the bars explicitly.

```{r}
ggplot(data = penguins_sum, mapping = aes(x = island, y = n)) +
  geom_col()
```

Notice that we had to supply `y = n` inside of `aes()`. A helpful way to remember this difference between `geom_bar()` and `geom_col()` is that Col needs Counts.

#### Histograms

When making histograms with `ggplot2`, you can use `geom_histogram()`. You should specify either the width of the bins or the number of bins in the histogram as appropriate for your data. Here we choose to use a `binwidth` of 100 grams:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = body_mass_g)) +
  geom_histogram(binwidth = 100)
```

#### Boxplots

Another useful graph is the boxplot. You can create multiple boxplots on the same graph by setting `x` to a variable with multiple categories In this example we will create a boxplot for each individual island.

```{r}
ggplot(data = penguins, mapping  = aes(x = island, y = body_mass_g)) +
  geom_boxplot()
```

#### More Aesthetics and Geoms

Below are some more examples of different aesthetics available with `ggplot2`.

Sometimes, when using `geom_point()`, our points can get a bit crowded. One way to address this is to change the transparency of the points. In this code, `alpha = 0.5` specifies the transparency of the points as 0.5, on a scale from 0 (most transparent) to 1 (least transparent):

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.5)
```

If we want to add another variable, but our graph is already a bit "busy" to look at,  `facet_wrap()` can come in handy. Here, we faceted by `species`, creating three graphs, with the same x and y axes and coloring. These graphs let us compare `species` side-by-side easily:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~species)
```

To read more about `ggplot2`, we recommend the [R for Data Science](https://r4ds.had.co.nz/data-visualisation.html) chapter about data visualization. More extensive documentation can be found on the [ggplot2 website](https://ggplot2.tidyverse.org/).

### Making Summary Tables in R

On the [Data Wrangling](LINK-HERE) page, we showed how to compute summary statistics for your data. Summary tables can be great for displaying data, and the `kable()` function in the R package `knitr` lets us do this easily.

Let's install and load the package first.

```{r eval = FALSE}
install.packages("knitr")
```

```{r}
library(knitr)
```

As before, we will use `palmerpenguins`, and we will use `kable()` to display the summary statistics we calculated over in our [Data Wrangling](LINK-HERE) section. Here is the code for our summary statistics, which we will save in a new dataset called `penguin_sum`.

```{r}
penguin_sum <- penguins %>%
  group_by(island, year) %>%
  summarise(mean_body_mass_g = mean(body_mass_g, na.rm = TRUE))
```

R lets us print datasets like this:

```{r}
penguin_sum
```

But that is not a very pretty table to look at. So let's make a nicer one with `kable()`.

```{r}
kable(x = penguin_sum, 
      format = "html",
      col.names = c("Island", "Year", "Mean Body Mass (g)"),
      caption = "Mean body mass of penguins on different islands over time")
```

There is a way to make it even fancier, and to do that we use the package `kableExtra`. 

```{r}
install.packages("kableExtra")
library(kableExtra)
```

We can start out with essentially the same code from making the basic `kable` table, but with `kableExtra` we can customize it more.

We can add the function `kable_styling()` to get the basic `kableExtra` format, rather than the previous default `kable` format:

```{r}
kable(x = penguin_sum, 
      col.names = c("Island", "Year", "Mean Body Mass (g)"),
      caption = "Mean body mass of penguins on different islands over time") %>%
  kable_styling()
```

We can customize the look of the table with `kable_classic()` as an alternitive to `kable_styling()`. There is also `kable_paper()`, `kable_classic_2()`,`kable_minimal()`, `kable_material()` and `kable_material_dark()`. 

By adding `full_width = FALSE` we can change the width of the table. We can also change the font, the font size, and there are even more additions and changes we could make, which are documented more extensively [here](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html#Overview).

```{r}
kable(x = penguin_sum, 
      col.names = c("Island", "Year", "Mean Body Mass (g)"),
      caption = "Mean body mass of penguins on different islands over time") %>%
   kable_classic(full_width = FALSE, html_font = "Cambria", font_size=16)
```

```{r}
kable(x = penguin_sum, 
      col.names = c("Island", "Year", "Mean Body Mass (g)"),
      caption = "Mean body mass of penguins on different islands over time") %>%
   kable_material_dark(html_font = "Cambria")
```


### Writing Up Your Results

R Markdown (`.Rmd`) is a great way to write up your results with R. This type of document integrates regular text and R code chunks. When using an R Markdown file, you can `Knit` in order to output a document with all of your text and code as well as the results of each code chunk pasted directly below the chunk. The most common output types to Knit to are `.pdf` (for "white papers") and `.html` (for web content.) When working in a Markdown file in RStudio you can find the `Knit` button in the tool bar near the top of the file.

For more in-depth information on R Markdown you can check out [this page](https://rmarkdown.rstudio.com/articles_intro.html)

Alternatively, if you want a text file where you can enter R commands wherever you want, you can use an R Script (`.R`). This type of document is useful for results that are mostly code and do not need to contain much regular text. 

To learn more about R Scripts you can check out the [Workflow: scripts](https://r4ds.had.co.nz/workflow-scripts.html) chapter in [R for Data Science](https://r4ds.had.co.nz/)

The decision to use an R script vs. an R Markdown document will largely depend on what you plan on doing with the document. If you would like to communicate your results, and especially if your audience is non-technical, R Markdown is definitely the way to go. If you work in an `.Rmd` document, you can knit to a format that most people will be familiar with, like a `.pdf` or a webpage. If, instead, you're working by yourself and would like to pass code back and forth with a collaborator or reader, R scripts are the way to go. The advantage to not knitting is that people reading your code can, ideally, open your code up in RStudio and immediately replicate your results.
