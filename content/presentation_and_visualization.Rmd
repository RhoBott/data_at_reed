---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(palmerpenguins)
library(tidyverse)
library(knitr)
```

# Presenting and Visualizing Data

### Intro to data visualization with ggplot2

`ggplot2` is an R package for data visualization that will allow you to make appealing and effective graphs using a simplified and standardized syntax.

First, let's load the package; this is necessary every time you start a graphing session. (To learn more about packages see our [Getting Started](LINK-HERE) page.) We will also load a dataset on penguin populations.

```{r}
library(ggplot2)
library(palmerpenguins)
```

Before we get started with graphing in `ggplot2`, we'll need our data to be in  "tidy" format. You can read more about what it means for a dataset to be tidy on [our data wrangling page](LINK-HERE) or [from the tidyverse team](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html).


There are three main pieces that make up a ggplot:

1. Data: You have to specify the data that you want `ggplot()` to plot using 
      
              data = ___

2. Aesthetics: In order for `ggplot()` to know which variables you want to use you have to specify what they are by using some combination of the following four options:

              aes(x = ___ , y = ___ , color = ___ , fill = ___ )

Anything that you put inside of `aes()` should be a variable. Additionally, though the whole wide array of possible inputs into `aes()` are given here, the ones that you end up using will be specific to your graph type. For example, in a typical histogram you are looking at the distribution of one variable so you only have to include `x = ___ `, and not the other inputs.

3. Geoms: We can specify what kind of plot we want to make using

              geom_---()

There are a wide range of different options but a couple of common ones are, `geom_point()` for a     scatterplot, and `geom_histogram()` for a histogram.

We can put all of this together to create a full template for making graphs with `ggplot()`:

              ggplot(data = ___ ,
                     mapping = aes(x = ___  , y = ___  , color = ___  , fill = ___   ) +
                geom_ ___ ()
          
You can always refer back to this template as a way to remember the `ggplot2` convention. 


#### Scatterplots

Suppose we're interested in how body mass changed over time on each of these islands. The following `ggplot2` graph might help us get at this question:

```{r}
ggplot(data = penguins, 
       mapping = aes(x = bill_length_mm, y = body_mass_g, color = island)) +
  geom_point()
```

Let's look at the components of our ggplot2 code, and how they made this graph:

First, we specified the `data` we were using, the penguin data. Next comes `mapping`, which essentially means "which variables encode what information": we told this graph to put bill length as the x axis, body mass as the y axis, and islands as the different colors. Finally, we add a `geom` layer to our plotâ€”in this case, we use points. `geom`s refer to the visual object used to represent data. In `geom_point()`, the `geom` is a point on a scatterplot.

#### Linegraphs

You can create a smoothed linegraph in exactly the same way as a scatterplot by swapping out `geom_point()` for `geom_line()`. This is an example of a different `geom`(etry) being used to represent the same data.

```{r, message = FALSE, warning = FALSE}
ggplot(data = penguins, 
       mapping = aes(x = bill_length_mm, y = body_mass_g)) +
  geom_smooth()
```

Looking at the data, you may have noticed that we have information on different islands of penguins. You can use `color` as a visual variable to represent the different island populations.

```{r, message = FALSE, warning = FALSE}
ggplot(data = penguins, 
       mapping = aes(x = bill_length_mm, y = body_mass_g, color = island)) +
  geom_smooth()
```

#### Barplots

Bar plots use the call `geom_bar()`.

```{r}
ggplot(data = penguins, mapping = aes(x = island)) +
  geom_bar()
```

You can display another variable by including `fill = ` inside of your `aes()` call.

```{r}
ggplot(data = penguins, mapping = aes(x = island, fill = sex)) +
  geom_bar()
```

In the above examples, `ggplot2` determines the height of bars by counting the number of observations behind the scenes. Sometimes, though, you might need to work with data that is "pre-counted." For example, if we make a new dataset giving the count of penguins by `island`:

```{r, message = FALSE, warning = FALSE}
penguins_sum <- penguins %>%
  count(island)

penguins_sum
```

To make the same graph, we need to use the `geom_col()` (as in "column") function, rather than `geom_bar()`, and supply the height of the bars explicitly.

```{r}
ggplot(data = penguins_sum, mapping = aes(x = island, y = n)) +
  geom_col()
```

Notice that we had to supply `y = n` inside of `aes()`.

#### Histograms

When making histograms with `ggplot2`, you can specify either the width of the bins or the number of the bins of the histogram as appropriate for your data. Here we chose to use a binwidth of 100 grams:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = body_mass_g)) +
  geom_histogram(binwidth = 100)
```

#### Boxplots

Another useful graph is the boxplot. You can create multiple boxplots on the same graph by setting your `x` to a variable with multiple levels. In this example our call will create a boxplot for each individual island.

```{r}
ggplot(data = penguins, mapping  = aes(x = island, y = body_mass_g)) +
  geom_boxplot()
```

#### More Aesthetics and Geoms

Below are some more examples of different aesthetics available with `ggplot2`.

Sometimes, when using `geom_point`, our points can get a bit crowded. One way to address this is to change the transparency of the points. In this code, `alpha = 0.7` specifies the transparency of the points as 0.7, on a scale from 0 (most transparent) to 1 (least transparent):

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.7)
```

What if we want to add another variable, but our graph is already a bit "busy" to look at? This is where `facet_wrap()` can come in handy. Here, I faceted by `species`, creating three graphs, with the same x and y axes and coloring. These graphs let us compare `species` side-by-side easily:

```{r, warning = FALSE}
ggplot(data = penguins, mapping = aes(x = bill_length_mm, y = bill_depth_mm, color = sex)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~species)
```

To read more about `ggplot2`, we recommend the [R for Data Science chapter](https://r4ds.had.co.nz/data-visualisation.html). More extensive documentation can be found on the [ggplot2 website](https://ggplot2.tidyverse.org/).

### Making Summary Tables in R

On the [Data Wrangling](LINK-HERE) page, we showed how to compute summary statistics for your data. Summary tables can be great for displaying data, and the `kable()` function in the R package `knitr` lets us do this easily.

Let's install and load the package first.

```{r eval = FALSE}
install.packages("knitr")
```

```{r}
library(knitr)
```

As before, we'll use `palmerpenguins`, and we'll use `kable()` to display the summary statistics we calculated over in our Data Wrangling section. Here is the code for our summary statistics, which I'll save in a new data frame called `penguin_sum`.

```{r}
penguin_sum <- penguins %>%
  group_by(island, year) %>%
  summarise(mean_body_mass_g = mean(body_mass_g, na.rm = TRUE))
```

R lets us print data frames like this:

```{r}
penguin_sum
```

But that's not a very pretty table to look at. So let's make a nicer one with `kable()`.

```{r}
kable(x = penguin_sum, 
      format = "html",
      col.names = c("Island", "Year", "Mean Body Mass (g)"),
      caption = "Mean body mass of penguins on different islands over time")
```

<!-- _Can we use KableExtra? How do I make this prettier if not?_ -->

### Writing Up Your Results

_yada yada about R Markdown_
