---
output: html_document
---

```{r, include = FALSE}
# to include emojis
#install.packages("emo")
library(emo)
```

# Loading Data

R is a wonderful tool for data cleaning, analysis, and visualization. But before we can do any of that, we need the actual data to work with! This page will help you learn to bring datasets into your R document in various ways: you can use a pre-loaded dataset, your own data from a .csv, excel sheet or a google sheet, or data found on the internet. 

### ...from a package

A lot of data you'll end up working with in R is contained in R packages! (If you're unfamiliar with packages, see our [Getting Started](abcdefg) page.) In fact, most of the data used in tutorials on the Data at Reed site comes from a package called `palmerpenguins`. The `palmerpenguins` package includes datasets from a study of three different species of penguins found in Antarctica.

```{r, echo = FALSE}
url <- "https://github.com/allisonhorst/palmerpenguins/raw/master/man/figures/lter_penguins.png"

knitr::include_graphics(url)
```

How can we load this data in?

First thing's first--you'll need to install the `palmerpenguins` package (or whatever package your data is from) if you haven't already with the `install.packages()` function:

```{r, eval = FALSE}
install.packages("palmerpenguins")
```

Now that you have the package installed, you need to load the package into your environment with `library()`. You only need to install the package once, but you'll need to load the package with your data every time you open R back up.

```{r}
library(palmerpenguins)
```

Okay... `palmerpenguins` is loaded... now where is the data?

This is a weird thing about loading data from packages--if you don't already know what you're looking for inside the package, how do you find out what's inside?

There are a couple ways. First, you could try running `help(package = "palmerpenguins"` in your console. This will show you all of the data and functions included in a package, as well as descriptions of what they are!

Alternatively, if you think all you need is a list of names of data or functions to jog your memory, you can make use of RStudio's autocomplete. Try typing the name of your package followed by two colons, like this 

```{r, eval = FALSE}
palmerpenguins::
```

Your tooltip should show you all of the datasets included in the package.

Regardless, now you've found the name of the dataset you want. From here, you can use the `data()` function! It just takes in the name of the dataset.

```{r}
data(penguins)
```

Depending on how datasets are included in a package, you might run that command and see nothing, or maybe just see `<Promise>` up in your Environment in the top-right corner of your RStudio. It might not look like your data is loaded, but it actually is! Try running the `View()` function in your console, which just takes in the name of your dataset.

```{r, eval = FALSE}
View(penguins)
```

You did it! Alternatively, if you just want to print the first few rows, try the `head()` function out, which also just takes the name of the dataset.

```{r}
head(penguins)
```

Ready to go. `r emo::ji("racing_car")`

### ...from a .csv (and friends, with `readr`)

A lot of data that you'll find on the internet will be in .csv format. This is a very common format of data that can be easily transferred between many different applications, including R! In order to load a .csv file into R, we'll need the `readr` package.

First, we'll need to install the `readr` package:

```{r, eval = FALSE}
install.packages("readr")
```

Now that you have the package installed, you need to load the package into your environment with `library()`. Again, you only need to install the package once, but you'll need to load the package with your data every time you open R back up.

```{r, warning = FALSE, message = FALSE}
library(readr)
```

Okay, we have the package, now how do we load the data?

First, you'll need to download the data and know where this data is on your computer.

`readr` contains a function called `read_csv()`, which uses a filepath to find a .csv file and then brings it into R. Here is an example:

```{r, eval = FALSE}
cat_data <- read_csv("Desktop/Reed/Bio123/cats.csv")
```

In the above code, we are taking a .csv called "cats.csv", located in a folder "Bio123" within a "Reed" folder on our Desktop. The filepath "Desktop/Reed/Bio123" gives directions to `read_csv()` on where to find "cats.csv". `read_csv()` not only finds this data, it also makes it into a data frame, which we then save using the `<-` operator under a name of our choosing (`cat_data`). This data is now available to us to use in this R session. You can `View()` it, make a graph with it, or display it in a table.

If you want to learn more about the `readr` package or the `read_csv()` function, [the package's website](https://readr.tidyverse.org/) is a more extensive overview of the package and its functions. You might also check out the [data import chapter](https://r4ds.had.co.nz/data-import.html) of the R for Data Science book.

### ...from Excel (with `readxl`)

If you've collected your own data in a class using Excel, and now want to bring it into R to work with, this process is made simple with the `readxl` package!

As before, let's first install the `readxl` package with the following code:

```{r, eval = FALSE}
install.packages("readxl")
```

Now that you have the package installed, you need to load the package into your environment with `library()`. Again, you only need to install the package once, but you'll need to load the package with your data every time you open R back up.

```{r, warning = FALSE, message = FALSE}
library(readxl)
```

The package `readxl` contains a function called `read_excel()`, that is very similar to `read_csv()` above. `read_excel()` will take a filepath, bring the data into R, and turn it into a nice data frame. The only difference is that the file will be a .xls or .xlsx, rather than .csv:

```{r, eval = FALSE}
cat_data <- read_excel("Desktop/Reed/Bio123/cats.xls")
```

"What if I have multiple sheets in my excel document?" you might ask. Great question! `read_excel()` can handle it. Let's say the "cats.xls" data has three sheets: the first sheet is about indoor cats, the second is about outdoor cats, and the third is about stray cats. We can load these in as follows:

```{r, eval = FALSE}
indoor_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = 1)
outdoor_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = 2)
stray_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = 3)
```

We can also call the sheets by their names instead of by numbers:

```{r, eval = FALSE}
indoor_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = "Indoor")
outdoor_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = "Outdoor")
stray_cat_data <- read_excel(path = "Desktop/Reed/Bio123/cats.xls", sheet = "Stray")
```

This code will help you to seamlessly bring in data from excel sheets without having to convert them to .csv format first. If you want to learn more about the `readxl` package or the `read_excel()` function, [here](https://readxl.tidyverse.org/) is a more extensive overview of the package and its functions.

### ...from Google Sheets (with `googlesheets4`)

Similar to Excel files, we can also read in data that you've collected via Google Sheets using the `googlesheets4` package. Let's install and then load that package:

```{r, eval = FALSE}
install.packages("googlesheets4")
```


```{r}
library(googlesheets4)
```

As you might suspect, loading data from Google Sheets is a tiny bit more complicated because of document ownership and privacy around your Google account. However, `googlesheets4` navigates this very elegantly. Note that you will want to make sure you can see your "Console" when you are using the following functions, because you will have to grant R access to your Google Sheets! Open your console by clicking the little double-window icon at the right of the gray bar that says "Console" below your current document. 

Now that you can see your console, let's begin! Navigate to the sheet you would like to read in, and copy the URL for that sheet. This can then be fed directly into to the `read_sheet()` function in `googlesheets4`, like so:

```{r}
example <- read_sheet("https://docs.google.com/spreadsheets/d/1qSGfs0ogEOQsynzAtoUIgU5NJDqn7bOd14L9qpWA3w8/edit?usp=sharing")
```

This code will prompt several interactive steps for you, in order to grant R access to your document.

1. In your console, you will be asked if it's okay to "cache OAuth access credentials in the folder" followed by a URL. This means: is it okay for R to gain access to your Google Drive in the future, or would you like to only grant one-time access? Type "1" in the console for yes, and click enter.

2. R will automatically open a window in your browser asking for tidyverse access to your google account. This will allow it to access your documents in the future when you want to read in files. Follow the directions in the browser and grant access. 

3. You will be asked to copy a URL from your browser window into your console, where you will paste it in as the "authorization code" and then click enter.

You're done! Check your "environment" in the top right corner of your R window, and you'll see your data in a nice data frame.

Whew, that was pretty involved. If you grant R access to your folders in the future, however, this will be a much smoother process after the first time. Don't worry!

If you want to learn more about `googlesheets4`, [the package's website](https://googlesheets4.tidyverse.org/) contains a more extensive overview of the package and its functions.

### ...from the internet (with `rvest`)

Let's say we find some data on a website that we would like to use. We've all been there: trying to copy/paste the whole table into excel or sheets, re-formatting, and eventually slamming the laptop shut before we've even finished. 

There is a better way with R! There almost always is!

We'll be using a wonderful package called `rvest`, which will let us easily grab data from the interwebs. Side note: before you do this, make sure you are thinking about whether or not this is data that you are allowed to take and use for your own purposes (add some resources to help students navigate this or link to data librarian?).

Ok ok ok, that was a longer intro than usual. Let's get into it. First, let's install and load the `rvest` package: 

```{r, eval = FALSE}
install.packages("rvest")
library(rvest)
```

```{r, echo = FALSE}
library(rvest)
```

We'll be scraping from [this](https://www.reed.edu/ir/success.html) page where Reed reports about the different occupations of alumni.

The first step is easy. We'll simply save the URL of this site under a variable name so that it's easy to use later:

```{r}
url <- "https://www.reed.edu/ir/success.html"
```

The next step requires that we tell R not only the URL of the graph, but also where on that page this graph is located. Here's how:

1. Right-click on the graph you want to bring into R, and click "inspect" in the menu that comes up. This will open a bar on the right of the window.

2. Hover your mouse over the lines of code in this bar on the right. You'll notice that as you do so, different sections of the webpage will be highlighted. Hover until you find a line of code that highlights the whole table that you want.

3. Right-click that line, go to copy > copy selector. You will then paste that text in the code below where it says `css = " "`. 

Notice we are using the `url` that we saved before. 

```{r}
reed_table <- url %>%
  read_html() %>%
  html_node(css = "#mainContent > table:nth-child(3)") %>%
  html_table()
```

Run the code and check your environment for the data frame `reed_table`!

Hopefully this `rvest` tutorial has been more helpful than overwhelming, as you can see that even though the code looks complicated, you really only need 2 things to make it work: 

1. The URL of the page that has your data table

2. The "selector" code that will tell R exactly where that table is

If you want to learn more about `rvest`, [the package's website](https://rvest.tidyverse.org/) contains a more extensive overview of the package and its functions.

### conclusions and more resources!!!



